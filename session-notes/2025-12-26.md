# Session Notes - December 26, 2025

## Summary

Comprehensive Lighthouse performance optimization session (2 parts).

**Session 1:** Optimized images and added dimensions across all major pages (Blog, Homepage, Contact, Services, Intentional Reset, Lab Review). Subsetted BDScript font from 295KB to 24KB.

**Session 2:** Subsetted all Poppins and Playfair Display fonts (1.22MB → 237KB, 80% reduction). Added responsive srcset images to homepage for mobile optimization.

**Total savings:** ~2MB+ (fonts: ~1.25MB, images: ~800KB+)

---

## Completed This Session

### Font Optimization

**BDScript Font Subsetting:**
| Before | After | Savings |
|--------|-------|---------|
| 295KB (full font) | 24KB (subset) | **92%** |

- Installed `subset-font` npm package
- Subsetted to only include characters: "intentional. simple. holistic."
- Updated `main.css` to use `BDScript-subset.ttf`

**Poppins + Playfair Display Font Subsetting (Session 2):**
| Font | Before | After | Savings |
|------|--------|-------|---------|
| PlayfairDisplay-Regular | 173KB | 66KB | **62%** |
| PlayfairDisplay-Italic | 163KB | 61KB | **63%** |
| PlayfairDisplay-Bold | 178KB | 67KB | **62%** |
| Poppins-Light | 143KB | 8.7KB | **94%** |
| Poppins-Regular | 142KB | 8.7KB | **94%** |
| Poppins-Medium | 140KB | 8.6KB | **94%** |
| Poppins-SemiBold | 139KB | 8.6KB | **94%** |
| Poppins-Bold | 138KB | 8.5KB | **94%** |
| **Total** | **1.22MB** | **237KB** | **80%** |

- Subsetted to Latin characters only (A-Z, a-z, 0-9, punctuation)
- Updated main.css @font-face declarations
- Updated font preload links on 12+ HTML pages

### Homepage Responsive Images (Session 2)

**New srcset variants created:**
| Image | Small | Medium | Full | Mobile Savings |
|-------|-------|--------|------|----------------|
| alicia-portrait-mug | 9.6KB (400w) | 25KB (800w) | 46KB (1200w) | **91%** vs JPG |
| the-process | 21KB (480w) | 37KB (720w) | 149KB (1440w) | **86%** on mobile |

- Converted alicia-portrait-mug.jpg to WebP (108KB → 46KB)
- Added srcset and sizes attributes for responsive loading
- Mobile devices now load 9.6KB instead of 108KB for portrait
- Updated both images on index.html

### Blog Index Page Performance

**Image Optimizations:**
| Image | Before | After | Savings |
|-------|--------|-------|---------|
| unmedicated-birth-new.webp | 61KB (1280×720) | 30KB (950×534) | **51%** |
| gut-health-pcos-new.webp | 31KB (1280×720) | 11KB (950×534) | **65%** |
| mental-health-pcos.webp | 22KB (1280×720) | 12KB (950×534) | **45%** |

**Code Changes:**
- Added `fetchpriority="high"` to first blog card image (LCP)
- Added CSS preload hints to blog/index.html
- Updated footer logo to use `logo-small.webp` (5.3KB vs 22KB)

### Contact Page Performance

**Optimizations:**
| Fix | Before | After | Savings |
|-----|--------|-------|---------|
| Removed services-v2.css | 61KB loaded | 0KB | **100%** |
| contact-hero.webp | 53KB (1760×990) | 15KB (1030×579) | **72%** |

- Added `fetchpriority="high"` to hero image
- Added width/height attributes (1030×579)

### Services Page Performance

**Image Optimizations:**
| Image | Before | After | Savings |
|-------|--------|-------|---------|
| preparation-feels-doable.webp | 155KB (1080×1350) | 64KB (950×1188) | **59%** |
| htma-features-bg | 149KB PNG (1753×462) | 23KB WebP (1000×264) | **85%** |
| who-i-help.webp | 26KB (800×537) | 23KB (950×638) | **12%** |

- Added `fetchpriority="high"` to LCP image
- Added dimensions to all 7 images
- Converted htma-features-bg.png to WebP

### Intentional Reset Page Performance

**Image Optimizations:**
| Image | Before | After | Savings |
|-------|--------|-------|---------|
| solution-photo-new.webp | 131KB (1200×1812) | 48KB (850×1284) | **63%** |
| intention-reset.webp | 130KB (1080×1350) | 74KB (950×1188) | **43%** |

- Added `fetchpriority="high"` to LCP image
- Added dimensions to all 3 images

### Lab Review Page Performance

**Image Optimizations:**
| Image | Before | After | Savings |
|-------|--------|-------|---------|
| horizontal-elements.webp | 117KB (888×720) | 31KB (950×770) | **74%** |
| alicia-lab-review-story.webp | 86KB (1016×1440) | 51KB (950×1346) | **41%** |

**CLS Fix:**
- Added `min-height: 90vh` to `.v3-hero` in services-v2.css
- Prevents ::before pseudo-element from shifting during font load
- CLS was 0.214 before fix

- Added `fetchpriority="high"` to LCP image
- Added dimensions to all images including footer

### Footer Logo Optimization (Site-Wide)

**Created smaller footer logo:**
| Before | After | Savings |
|--------|-------|---------|
| logo.webp 22KB (500×500) | logo-small.webp 5.3KB (240×240) | **76%** |

Updated 15+ HTML files to use `logo-small.webp` for footer.

---

## Files Modified

| File | Changes |
|------|---------|
| `/css/main.css` | BDScript font now uses subset version |
| `/css/services-v2.css` | Added min-height: 90vh to .v3-hero for CLS fix |
| `/js/blog.js` | Added fetchpriority to first blog card image |
| `/blog/index.html` | CSS preload hints, smaller footer logo |
| `/blog/post.html` | Smaller footer logo |
| `/contact.html` | Removed services-v2.css, optimized hero image |
| `/services/services.html` | Added dimensions/fetchpriority to 7 images |
| `/services/intentional-reset.html` | Added dimensions/fetchpriority to 3 images |
| `/services/lab-review.html` | Added dimensions/fetchpriority to 4 images |
| All HTML files | Updated footer logo to logo-small.webp |

### Images Created/Optimized

| Original | Optimized |
|----------|-----------|
| BDScript-Regular.ttf (295KB) | BDScript-subset.ttf (24KB) |
| logo.webp (22KB) | logo-small.webp (5.3KB) |
| unmedicated-birth-new.webp | Resized 1280→950 |
| gut-health-pcos-new.webp | Resized 1280→950 |
| mental-health-pcos.webp | Resized 1280→950 |
| contact-hero.webp | Resized 1760→1030 |
| preparation-feels-doable.webp | Resized 1080→950 |
| htma-features-bg.png | Converted to WebP, resized |
| who-i-help.webp | Resized 800→950 |
| horizontal-elements.webp | Resized 888→950 |
| alicia-lab-review-story.webp | Resized 1016→950 |
| intention-reset.webp | Resized 1080→950 |
| solution-photo-new.webp | Resized 1200→850 |

---

## Performance Summary

### Total Estimated Savings

| Category | Savings |
|----------|---------|
| Font (BDScript) | 271KB |
| Fonts (Poppins + Playfair) | **~980KB** |
| Blog images | ~64KB |
| Contact page | ~99KB |
| Services page | ~220KB |
| Intentional Reset | ~139KB |
| Lab Review | ~121KB |
| Footer logo (×15 pages) | ~17KB each |
| Homepage responsive (mobile) | ~160KB |
| **Total** | **~2MB+** |

### Key Fixes Applied

1. **fetchpriority="high"** on all LCP images
2. **Explicit width/height** on all images to prevent CLS
3. **Responsive image sizing** for mobile (2x retina)
4. **Font subsetting** for script font
5. **Removed unused CSS** from contact page
6. **min-height on hero sections** to prevent CLS from pseudo-elements

---

## Pending Tasks

### From Previous Sessions
1. About page version selection (v1 or v2)
2. Legal pages attorney review (`/tasks/legal-attorney-review.md`)

### Post-Deploy
- ~~Exclude developer devices from easter egg tracking~~ ✅ Done
- ~~Test forms in production~~ ✅ Done
- ~~Set up email notifications for forms~~ ✅ Done (contact + application)
- Set up GA4 conversion events
- **Set up MailerLite email marketing** - Connect lead magnet form ("Holistic Habits Checklist") to deliver PDF automatically via email automation
- **Finalize application/booking flow** - Iron out the flow from Apply button → application form (possibly move to PracticeBetter) → redirect to schedule 20-minute call on PracticeBetter. Need to decide: keep website form or use PracticeBetter's intake form, and ensure smooth handoff to scheduling.

### Optional Future Optimizations
- ~~Create responsive image variants with srcset for homepage~~ ✅ Done
- ~~Subset Poppins and Playfair Display fonts~~ ✅ Done (saved ~980KB)

---

## Next Session Plan

1. **Deep review** - Copy, content, and images across all pages
2. **About page finalization** - Select v1 or v2, archive the other
3. **Netlify deployment** - Step-by-step walkthrough for pushing live
4. **Post-launch tasks** - Forms testing, GA4 events, easter egg exclusions

---

## Quick Reference

**Lighthouse Optimization Checklist:**
1. Check LCP image has `fetchpriority="high"`
2. All images have explicit `width` and `height`
3. Images sized for 2x display (e.g., 950px for 475px display)
4. No unused CSS files loaded
5. Hero sections have min-height to prevent CLS

**Image Sizing Formula:**
- Display size × 2 = Source image size (for retina)
- Example: 475px display → 950px source image

---

## Session Continuation (Part 3) - Blog & UX Improvements

### Blog Post Duplicate Title Fix

**Problem:** Blog posts displayed titles twice - once from the `title:` property in the post metadata (rendered by the template) and again from the `# Title` heading in the markdown content itself.

**Solution:** Modified the `parseMarkdown()` function in `/js/blog.js` to strip any leading H1 heading from the markdown content before rendering.

**Code Added:**
```javascript
// Strip leading H1 if present (title is already displayed by template)
html = html.replace(/^\s*#\s+[^\n]+\n*/m, '');
```

**Why This Matters:**
- Cleaner reading experience
- Proper semantic HTML (only one H1 per page)
- Blog authors can include `# Title` in markdown for preview purposes without it duplicating

---

### Dynamic Blog Image Aspect Ratios

**Problem:** Blog card images were using a fixed aspect ratio (56.25% / 16:9), but actual blog images have varying dimensions. This caused some images to be cropped awkwardly or show white space.

**Solution:** Implemented a flexible aspect ratio system using CSS padding-bottom technique with per-post customization.

**Technical Approach:**

1. **CSS padding-bottom technique** - The `.blog-card-image-link` container uses `padding-bottom` as a percentage to create the aspect ratio. This works because padding percentages are calculated relative to the element's width.

2. **Per-post properties** - Each blog post can now specify:
   - `cardAspectRatio` - Aspect ratio for card thumbnails on the blog index
   - `imageAspectRatio` - Aspect ratio for the featured image on the post page

3. **CSS Variable for featured images** - The post page sets `--featured-aspect-ratio` dynamically based on the post's `imageAspectRatio` property.

**Blog Post Aspect Ratios Set:**

| Post | Slug | Image Dimensions | Aspect Ratio |
|------|------|------------------|--------------|
| Holiday Wellness | holiday-wellness-guide | 900×506 | 56.22% |
| Unmedicated Birth | unmedicated-birth | 949×534 | 56.27% |
| Body First Home | body-first-home | 900×506 | 56.22% |
| Mental Health PCOS | mental-health-pcos | 949×534 | 56.27% |
| Smoothie Bowl | smoothie-bowl-hormone-health | 600×500 | **83.33%** |
| Gut Health PCOS | gut-health-pcos | 949×534 | 56.27% |
| Granola | granola-recipe | 900×506 | 56.22% |

**Note:** The Smoothie Bowl image is notably different (nearly square at 83.33%) compared to others (~56%). This is now properly handled.

**Aspect Ratio Formula:**
```
aspectRatio = (height / width) × 100
Example: 500 / 600 = 0.8333 → 83.33%
```

---

### Author Byline Alignment

**Change:** Moved author byline ("By Alicia Harrison, MSN, APRN, FNP-C") to the right side of the post metadata line.

**CSS Update in `/css/blog.css`:**
```css
.post-meta {
  display: flex;
  justify-content: space-between;  /* Date left, author right */
  align-items: center;
  /* ... other styles ... */
}
```

**Result:**
- Left: Publication date
- Right: Author name with credentials

---

### Practice Better Integration - Application Flow

**Background:** Previously, "Apply" and "Get Started" CTAs linked to `/apply.html`, a Netlify Forms page. Decision was made to redirect users directly to Practice Better's intake form instead.

**Approach Considered:**
1. **Embedding Practice Better forms** - Possible via iframe, but adds complexity and potential HIPAA/security considerations with cross-origin forms
2. **Native redirect** - Simpler, leverages Practice Better's own secure environment

**Decision:** Use native redirect with a polished transition overlay.

---

### Portal Redirect Popup - Full Implementation

**User Experience Flow:**
1. User clicks any CTA with `data-portal` attribute
2. Full-screen overlay fades in (cream background matching brand)
3. Logo displayed prominently (200px, centered)
4. "Continuing to Secure Portal" heading
5. Animated loading dots (3 dots bouncing in sequence)
6. "HIPAA Compliant & Secure" badge with shield icon
7. After 1.5 seconds, user is redirected to Practice Better

**JavaScript Implementation (`/js/main.js`):**

```javascript
// -----------------------------------------
// PORTAL REDIRECT OVERLAY
// -----------------------------------------
(function() {
  var PORTAL_URL = 'https://my.practicebetter.io/#/65f9b5add14abe8b539487a6/forms?f=661efbf14a1d3d6613c89cf0';
  var REDIRECT_DELAY = 1500; // 1.5 seconds

  // Find all portal links (with data-portal attribute)
  var portalLinks = document.querySelectorAll('[data-portal]');

  portalLinks.forEach(function(link) {
    link.addEventListener('click', function(e) {
      e.preventDefault();

      // Create overlay dynamically
      var overlay = document.createElement('div');
      overlay.className = 'portal-redirect-overlay';
      overlay.innerHTML =
        '<div class="portal-redirect-content">' +
          '<img src="/images/logo.webp" alt="Intention Holistic Health" class="portal-redirect-logo">' +
          '<h2 class="portal-redirect-title">Continuing to Secure Portal</h2>' +
          '<div class="portal-redirect-dots"><span></span><span></span><span></span></div>' +
          '<div class="portal-redirect-badge">' +
            '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
              '<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>' +
            '</svg>' +
            '<span>HIPAA Compliant & Secure</span>' +
          '</div>' +
        '</div>';

      document.body.appendChild(overlay);

      // Trigger fade-in animation
      setTimeout(function() {
        overlay.classList.add('active');
      }, 10);

      // Redirect after delay
      setTimeout(function() {
        window.location.href = PORTAL_URL;
      }, REDIRECT_DELAY);
    });
  });
})();
```

**CSS Styles (`/css/main.css`):**

```css
/* PORTAL REDIRECT OVERLAY */
.portal-redirect-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(249, 245, 240, 0.97);  /* Brand cream */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.portal-redirect-overlay.active {
  opacity: 1;
}

.portal-redirect-logo {
  width: 200px;
  height: auto;
  margin: 0 auto 1.5rem;
  display: block;
}

/* Animated bouncing dots */
.portal-redirect-dots span {
  width: 12px;
  height: 12px;
  background-color: var(--color-sage-green);
  border-radius: 50%;
  animation: portalDotBounce 1.4s infinite ease-in-out both;
}

.portal-redirect-dots span:nth-child(1) { animation-delay: -0.32s; }
.portal-redirect-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes portalDotBounce {
  0%, 80%, 100% { transform: scale(0); }
  40% { transform: scale(1); }
}
```

**CTAs Updated with `data-portal` Attribute:**

| Page | File | CTAs Modified | Button Text Examples |
|------|------|---------------|---------------------|
| HTMA | `/htma.html` | 5 | "Start Now", "Get Started", "Apply Now" |
| Services | `/services/services.html` | 4 | "Get Started", "Apply Now" |
| Intentional Reset | `/services/intentional-reset.html` | 3 | "Apply Now", "Get Started" |
| About | `/about.html` | 1 | "Work With Me" |
| About v2 (draft) | `/drafts/about-v2.html` | 1 | "Work With Me" |

**Total: 14 CTAs across 5 pages**

**HTML Pattern Used:**
```html
<!-- Before -->
<a href="/apply.html" class="btn" target="_blank" rel="noopener">Apply Now</a>

<!-- After -->
<a href="#" class="btn" data-portal>Apply Now</a>
```

**Notes:**
- `target="_blank"` and `rel="noopener"` removed since JavaScript handles the redirect
- `href="#"` used as fallback (JS prevents default)
- `data-portal` attribute triggers the overlay behavior

**Current Portal Destination:**
```
https://my.practicebetter.io/#/65f9b5add14abe8b539487a6/forms?f=661efbf14a1d3d6613c89cf0
```
This links directly to a specific intake form in Practice Better. URL can be easily updated in one place (`PORTAL_URL` variable in main.js) if the form changes.

---

### Troubleshooting Notes

**Logo Not Loading Issue:**
- Initial implementation used `/brand/logo.webp`
- Logo file is actually at `/images/logo.webp`
- Fixed path in the overlay HTML

**Console Errors on Practice Better:**
After redirect, Chrome DevTools showed warnings:
```
Error with Permissions-Policy header: Unrecognized feature: 'document-domain'
Error with Permissions-Policy header: Unrecognized feature: 'execution-while-not-rendered'
Firebase JS SDK development build warning
```
These are from Practice Better's site, not our code. They're minor configuration issues on their end and don't affect functionality.

---

### Files Modified Summary (Part 3)

| File | Changes |
|------|---------|
| `/js/main.js` | Added portal redirect overlay (lines 60-103) |
| `/js/blog.js` | Strip leading H1 in parseMarkdown(), added aspect ratio properties to all 7 posts |
| `/css/main.css` | Added ~90 lines of portal overlay styles |
| `/css/blog.css` | Padding-bottom aspect ratio technique, CSS variable for featured images, right-aligned author |
| `/htma.html` | Changed 5 CTAs: added `data-portal`, removed external link attributes |
| `/services/services.html` | Changed 4 CTAs: added `data-portal` |
| `/services/intentional-reset.html` | Changed 3 CTAs: added `data-portal` |
| `/about.html` | Changed 1 CTA: added `data-portal` |
| `/drafts/about-v2.html` | Changed 1 CTA: added `data-portal` |
| `/CLAUDE.md` | Added blog image aspect ratio documentation |

---

### Commits

1. **Previous commits this session** (performance optimization - see earlier sections)

2. **`b8c01c0`** - Add portal redirect popup for Practice Better CTAs
   - Portal overlay with logo, animated dots, security badge
   - 14 CTAs updated across 5 pages
   - 1.5 second transition delay
   - Pushed to both `drafts-website-edits` and `main` branches
